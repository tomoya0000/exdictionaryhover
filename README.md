# ExDictionaryHover

ExDictionaryHoverは、外部ファイル（CSV/TSV形式）で定義したSQL辞書を参照し、エディタ上でSQL IDにカーソルを合わせると対応するSQL文や説明をホバー表示するVisual Studio Code拡張機能です。

## 主な機能

- 高速なマッピング: Mapを使用した効率的なSQLマッピングで快適な動作
- 柔軟な設定: CSV/TSVファイルのパス、列番号、エンコードを自由に設定可能
- マルチファイルサポート: 複数の辞書ファイルを同時に読み込み可能
- 複数説明列対応: 複数の列の説明文を区切り線で表示可能
- インテリジェントな検索:
  - 引用符（半角/全角）で囲まれたSQL IDも正しく認識
  - SQL IDの末尾1桁を除外した柔軟な検索にも対応
- エラー通知: 問題発生時は通知とログで詳細を確認可能

## インストールと使い方

### インストール

1. 配布されたVSIXファイル（`ExDictionaryHover-x.x.x.vsix`）をダウンロード
2. VS Codeを開き、拡張機能ビュー（Ctrl+Shift+X）を表示
3. 拡張機能ビューの「...」（その他のアクション）メニューから「VSIXからのインストール...」を選択
4. ダウンロードしたVSIXファイルを選択
5. VS Codeを再起動して拡張機能を有効化

### 設定方法

1. SQL ID・SQL文・説明を含むCSV/TSVファイルを準備（1行目はヘッダー行として扱われます）
2. VS Codeの設定（settings.json）で以下を設定:
   - CSVファイルのパス（相対パスまたは絶対パス）
   - ID列、SQL列、説明列の番号（0始まり）
   - 必要に応じてエンコードを指定（デフォルトはUTF-8）

### 使用方法

1. VS Codeでファイルを開く
2. SQL IDにカーソルを合わせる（引用符で囲まれていても認識）
3. ホバーウィンドウにSQL文と説明が表示される

### 表示例

**単一説明列の場合:**
```
SELECT * FROM users WHERE id = ?;

ーーーーーーーーーーーーーーーーーーーー

ユーザーテーブルから指定されたIDのデータを取得
```

**複数説明列の場合:**
```
SELECT * FROM users WHERE id = ?;

ーーーーーーーーーーーーーーーーーーーー

ユーザーテーブルから指定されたIDのデータを取得

【銀行連絡要】システム部経由でLeadInX社へ問い合わせる
```

## 拡張機能設定

この拡張機能は以下の設定をサポートします（`settings.json`に記述）:

```json
"exDictionaryHover.csvFiles": [
  {
    "filePath": "sql/sqlmap.tsv",
    "idCol": 0,
    "sqlCol": 1,
    "descCol": 2,
    "encode": "utf-8"
  },
  {
    "filePath": "sql/messages.tsv",
    "idCol": 0,
    "sqlCol": 3,
    "descCol": [4, 5],
    "encode": "shift_jis"
  }
]
```

- `filePath`: CSV/TSVファイルのパス（拡張機能ディレクトリ基準、または絶対パス）
- `idCol`: SQL IDの列番号（0始まり、必須）
- `sqlCol`: SQL文の列番号（0始まり、必須）
- `descCol`: 説明の列番号（0始まり、省略可）
  - 単一列: `"descCol": 2` - 1つの列を説明として使用
  - 複数列: `"descCol": [4, 5]` - 複数の列を区切り線で結合して表示
- `encode`: ファイルのエンコード（省略可、デフォルトutf-8）
  - 対応エンコード: utf-8, shift_jis, euc-jp など
  - エイリアス対応: sjis, shiftjis → shift_jis, eucjp → euc-jp

## 必要条件

- Visual Studio Code v1.100.0 以上

## トラブルシューティング

### ログの確認方法

1. VS Code の「表示」メニューから「出力」を選択
2. 出力パネルのドロップダウンから「ExDictionaryHover」を選択
3. 以下のログを確認可能:
   - ファイル読み込み状況
   - SQLマッピング登録状況
   - エラーや警告メッセージ
   - ホバー検索の詳細

### 一般的な問題

- SQL IDが辞書に存在しない場合は何も表示されません
- CSV/TSVファイルの1行目はヘッダーとして扱われます
- ファイルが見つからない場合はエラー通知が表示されます
- エンコーディングエラーの場合は出力パネルにエラー詳細が記録されます
- サポート外のエンコーディングはUTF-8として処理されます

### パフォーマンスについて

- MapベースのルックアップによりO(1)の検索パフォーマンス
- メモリ使用量は登録されたSQL数に比例します
- 大規模な辞書ファイルでも高速な検索が可能です

## リリースノート

### 0.2.0

- **新機能**: 複数説明列対応
  - `descCol`に配列を指定して複数列の説明文を表示可能
  - 複数列の内容は区切り線で視覚的に分離して表示
- **設定改善**: VS Code設定スキーマの強化
  - settings.jsonでの型検証とIntelliSenseを改善
  - 単一列・複数列の両方の形式をサポート

### 0.1.0

- パフォーマンス改善: Mapを使用した高速なルックアップを実装
- クォーテーション対応: 半角/全角の引用符で囲まれたSQL IDも認識
- 検索機能強化: SQL ID末尾1桁を除外した検索にも対応
- ログ機能の強化: 出力パネルでのログ表示とエラー通知を追加
- エンコード対応強化: 主要なエンコーディングとエイリアスをサポート

### 0.0.1

- 初期リリース: SQL辞書ファイルのホバー表示に対応

---

## ライセンス

MIT
